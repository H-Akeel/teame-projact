<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>PDF Suite | صور إلى PDF</title>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'IBM Plex Sans Arabic', sans-serif; background:#f5f8fc; padding:20px; }
    .tool-card { background:#fff; padding:20px; border-radius:12px; max-width:800px; margin:auto; }
    .input-area { border:2px dashed #aaa; padding:20px; text-align:center; cursor:pointer; margin-bottom:20px; }
    .thumbs { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .thumb img { max-width:120px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1);}
    .options-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px; }
    select { width:100%; padding:10px; border-radius:8px; }
    .btn { padding:12px 25px; border:none; border-radius:8px; background:#4a55ff; color:#fff; font-weight:700; cursor:pointer; }
    .btn:disabled { background:#aaa; cursor:not-allowed; }
  </style>
</head>
<body>

  <div class="tool-card">
    <h1>تحويل صور إلى PDF</h1>
    <p>اختر صورك وحدد حجم الصفحة وطريقة العرض.</p>

    <div class="input-area" id="img2pdf-dropzone">
      <p>اسحب الصور أو <label for="img2pdf-input" style="color:#4a55ff; cursor:pointer;">اختر من جهازك</label></p>
      <input type="file" id="img2pdf-input" accept="image/*" multiple hidden>
    </div>

    <div class="thumbs" id="img2pdf-thumbs"></div>

    <!-- خيارات جديدة -->
    <div class="options-grid">
      <div class="option-group">
        <label for="img2pdf-size">حجم الصفحة</label>
        <select id="img2pdf-size">
          <option value="auto">مطابقة حجم الصورة</option>
          <option value="A4">A4 (210 × 297 ملم)</option>
          <option value="Letter">Letter (8.5 × 11 إنش)</option>
        </select>
      </div>
      <div class="option-group">
        <label for="img2pdf-fit">طريقة العرض</label>
        <select id="img2pdf-fit">
          <option value="fit">ملء الصفحة</option>
          <option value="original">الحجم الأصلي</option>
        </select>
      </div>
    </div>

    <div style="margin-top:20px;">
      <button class="btn" id="img2pdf-run" disabled>بدء التحويل</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById("img2pdf-input");
      const thumbs = document.getElementById("img2pdf-thumbs");
      const runBtn = document.getElementById("img2pdf-run");
      const sizeSelect = document.getElementById("img2pdf-size");
      const fitSelect = document.getElementById("img2pdf-fit");

      let files = [];

      input.addEventListener("change", (e) => {
        files = Array.from(e.target.files);
        runBtn.disabled = files.length === 0;
        renderThumbs();
      });

      const renderThumbs = () => {
        thumbs.innerHTML = "";
        files.forEach((file) => {
          const url = URL.createObjectURL(file);
          const img = document.createElement("img");
          img.src = url;
          const wrap = document.createElement("div");
          wrap.className = "thumb";
          wrap.appendChild(img);
          thumbs.appendChild(wrap);
        });
      };

      const downloadBlob = (blob, filename) => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; 
        a.download = filename; 
        a.click();
        setTimeout(() => URL.revokeObjectURL(url), 2000);
      };

      runBtn.addEventListener("click", async () => {
        if (files.length === 0) return alert("اختر صورة واحدة على الأقل");
        runBtn.disabled = true;

        try {
          const pdfDoc = await PDFLib.PDFDocument.create();

          for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const bytes = await file.arrayBuffer();
            let img;
            if (file.type === "image/png") img = await pdfDoc.embedPng(bytes);
            else img = await pdfDoc.embedJpg(bytes);

            // تحديد الحجم
            const sizeChoice = sizeSelect.value;
            const fitChoice = fitSelect.value;
            let pageWidth, pageHeight;
            if (sizeChoice === "A4") {
              pageWidth = 595.28; // 210mm
              pageHeight = 841.89; // 297mm
            } else if (sizeChoice === "Letter") {
              pageWidth = 612; // 8.5 inch
              pageHeight = 792; // 11 inch
            } else {
              pageWidth = img.width;
              pageHeight = img.height;
            }

            const page = pdfDoc.addPage([pageWidth, pageHeight]);

            if (fitChoice === "fit" && sizeChoice !== "auto") {
              const scale = Math.min(pageWidth / img.width, pageHeight / img.height);
              const imgW = img.width * scale;
              const imgH = img.height * scale;
              const x = (pageWidth - imgW) / 2;
              const y = (pageHeight - imgH) / 2;
              page.drawImage(img, { x, y, width: imgW, height: imgH });
            } else {
              page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
            }
          }

          const pdfBytes = await pdfDoc.save();
          downloadBlob(new Blob([pdfBytes], { type: "application/pdf" }), "images.pdf");
          alert("✅ تم إنشاء PDF بنجاح!");
        } catch (err) {
          alert("❌ خطأ: " + err.message);
        }

        runBtn.disabled = false;
      });
    });
  </script>
</body>
</html>

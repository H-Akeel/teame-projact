<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="..//Photo/t ~.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Suite | منصة الأدوات الاحترافية</title>

  <!-- Libraries -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    :root {
      --bg-color: #eef2f9;
      --card-color: #f5f8fc;
      --primary-color: #4a55ff;
      --primary-light: #6a72ff;
      --secondary-color: #a45eff;
      --text-color: #2c3e50;
      --muted-color: #8d99ae;
      --border-color: rgba(255, 255, 255, 0.5);
      --radius: 16px;
    }
    body { font-family:'IBM Plex Sans Arabic',sans-serif; background:var(--bg-color); display:flex; }
    .sidebar { width:260px; background:var(--card-color); padding:20px; }
    .main-content { flex-grow:1; padding:40px; height:100vh; overflow-y:auto; }
    .tool-card { background:var(--card-color); padding:30px; border-radius:var(--radius); }
    .options-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-top:15px; }
    select { width:100%; padding:10px; border-radius:10px; }
    .btn { background:linear-gradient(90deg,var(--primary-color),var(--primary-light)); color:#fff; border:none; border-radius:12px; padding:12px 25px; cursor:pointer; font-weight:700; }
    .thumbs { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .thumb img { max-width:120px; border-radius:8px; }
  </style>
</head>
<body>

  <aside class="sidebar">
    <div class="logo">PDF Suite</div>
    <ul class="nav-menu">
      <li><a data-page="merge" class="nav-link active">دمج الملفات</a></li>
      <li><a data-page="img2pdf" class="nav-link">صور إلى PDF</a></li>
      <li><a data-page="pdf2img" class="nav-link">PDF إلى صور</a></li>
      <li><a data-page="split" class="nav-link">تقسيم ملف</a></li>
      <li><a data-page="extract" class="nav-link">استخراج النصوص</a></li>
    </ul>
  </aside>

  <main class="main-content">

    <!-- Page: Images to PDF -->
    <section id="img2pdf" class="tool-page active">
      <div class="page-header">
        <h1>تحويل صور إلى PDF</h1>
        <p>اجمع صورك في ملف PDF واحد مع التحكم في حجم الصفحة وطريقة العرض.</p>
      </div>
      <div class="tool-card">
        <div class="input-area" id="img2pdf-dropzone">
          <p>اسحب الصور هنا أو <label for="img2pdf-input" style="color:var(--primary-color);cursor:pointer;">اختر من جهازك</label></p>
          <input type="file" id="img2pdf-input" accept="image/*" multiple hidden>
        </div>
        <div class="thumbs" id="img2pdf-thumbs"></div>

        <!-- خيارات جديدة -->
        <div class="options-grid">
          <div class="option-group">
            <label for="img2pdf-size">حجم الصفحة</label>
            <select id="img2pdf-size">
              <option value="auto">مطابقة حجم الصورة</option>
              <option value="A4">A4 (210 × 297 ملم)</option>
              <option value="Letter">Letter (8.5 × 11 إنش)</option>
            </select>
          </div>
          <div class="option-group">
            <label for="img2pdf-fit">طريقة العرض</label>
            <select id="img2pdf-fit">
              <option value="fit">ملء الصفحة</option>
              <option value="original">الحجم الأصلي</option>
            </select>
          </div>
        </div>

        <div style="margin-top:20px;">
          <button class="btn" id="img2pdf-run" disabled>بدء التحويل</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById("img2pdf-input");
      const thumbs = document.getElementById("img2pdf-thumbs");
      const runBtn = document.getElementById("img2pdf-run");
      const sizeSelect = document.getElementById("img2pdf-size");
      const fitSelect = document.getElementById("img2pdf-fit");

      let files = [];

      input.addEventListener("change", (e) => {
        files = Array.from(e.target.files);
        runBtn.disabled = files.length === 0;
        renderThumbs();
      });

      const renderThumbs = () => {
        thumbs.innerHTML = "";
        files.forEach((file) => {
          const url = URL.createObjectURL(file);
          const img = document.createElement("img");
          img.src = url;
          const wrap = document.createElement("div");
          wrap.className = "thumb";
          wrap.appendChild(img);
          thumbs.appendChild(wrap);
        });
      };

      const downloadBlob = (blob, filename) => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; 
        a.download = filename; 
        a.click();
        setTimeout(() => URL.revokeObjectURL(url), 2000);
      };

      runBtn.addEventListener("click", async () => {
        if (files.length === 0) return alert("اختر صورة واحدة على الأقل");
        runBtn.disabled = true;

        try {
          const pdfDoc = await PDFLib.PDFDocument.create();

          for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const bytes = await file.arrayBuffer();
            let img;
            if (file.type === "image/png") img = await pdfDoc.embedPng(bytes);
            else img = await pdfDoc.embedJpg(bytes);

            // قراءة خيارات المستخدم
            const sizeChoice = sizeSelect.value;
            const fitChoice = fitSelect.value;

            let pageWidth, pageHeight;
            if (sizeChoice === "A4") {
              pageWidth = 595.28;  // 210mm
              pageHeight = 841.89; // 297mm
            } else if (sizeChoice === "Letter") {
              pageWidth = 612;  
              pageHeight = 792;  
            } else {
              pageWidth = img.width;
              pageHeight = img.height;
            }

            const page = pdfDoc.addPage([pageWidth, pageHeight]);

            if (fitChoice === "fit" && sizeChoice !== "auto") {
              const scale = Math.min(pageWidth / img.width, pageHeight / img.height);
              const imgW = img.width * scale;
              const imgH = img.height * scale;
              const x = (pageWidth - imgW) / 2;
              const y = (pageHeight - imgH) / 2;
              page.drawImage(img, { x, y, width: imgW, height: imgH });
            } else {
              page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
            }
          }

          const pdfBytes = await pdfDoc.save();
          downloadBlob(new Blob([pdfBytes], { type: "application/pdf" }), "images.pdf");
          alert("✅ تم إنشاء PDF بنجاح!");
        } catch (err) {
          alert("❌ خطأ: " + err.message);
        }

        runBtn.disabled = false;
      });
    });
  </script>
</body>
</html>

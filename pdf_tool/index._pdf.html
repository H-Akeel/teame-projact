<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø£Ø¯ÙˆØ§Øª PDF Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>

  <!-- Libraries -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js";</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#f6f9fc;
      --card:#fff;
      --primary:#1976d2;
      --primary-dark:#0d47a1;
      --muted:#6b7280;
      --ring:#cfe3ff;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:'Cairo',system-ui,Segoe UI,Arial,sans-serif;
      background:linear-gradient(90deg,#eef5ff,#ffffff);
      color:#1f2937;
    }
    header,footer{
      background:linear-gradient(270deg,var(--primary-dark),var(--primary));
      color:#fff;text-align:center;padding:22px 18px;
      box-shadow:0 6px 16px rgba(0,0,0,.18)
    }
    header h1{margin:6px 0 0;font-size:28px}
    main{max-width:1100px;margin:32px auto;padding:0 16px}
    .grid{display:grid;gap:22px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .tool{
      background:var(--card);border-radius:var(--radius);
      box-shadow:0 8px 24px rgba(0,0,0,.08);
      padding:22px;transition:.25s transform,.25s box-shadow
    }
    .tool:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(0,0,0,.12)}
    .tool h2{margin:0 0 10px;color:var(--primary-dark);font-size:20px}
    .sub{margin:0 0 16px;color:var(--muted);font-size:14px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    input[type="file"], input[type="number"], input[type="text"]{
      padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;background:#fff;
      font-size:14px;min-width:220px;outline:none;transition:.2s border
    }
    input:focus{border-color:var(--primary)}
    .range{display:flex;gap:8px;align-items:center}
    .btn{
      background:var(--primary);color:#fff;border:0;border-radius:12px;
      padding:10px 16px;cursor:pointer;font-weight:700;font-size:14px;
      transition:.2s background,.2s transform
    }
    .btn:hover{background:var(--primary-dark);transform:translateY(-1px)}
    .btn.outline{background:#fff;color:var(--primary);border:1px solid var(--primary)}
    .muted{color:var(--muted);font-size:13px}
    .downloads a{display:inline-block;margin-top:8px;margin-right:8px;text-decoration:underline}
    .preview{
      margin-top:12px;border:1px dashed #cbd5e1;border-radius:12px;padding:10px;
      background:#fafbff;min-height:80px
    }
    .thumbs{display:flex;gap:10px;flex-wrap:wrap}
    .thumb{
      position:relative;background:#fff;border:1px solid #e5e7eb;border-radius:10px;
      padding:6px;box-shadow:0 2px 8px rgba(0,0,0,.06);user-select:none
    }
    .thumb canvas,.thumb img{display:block;max-width:140px;height:auto;border-radius:6px}
    .handle{
      position:absolute;inset-inline-start:6px;top:6px;background:#ffffffd9;border:1px solid #e5e7eb;
      border-radius:8px;padding:2px 6px;font-size:12px;cursor:grab
    }
    .drag-over{outline:2px solid var(--ring)}
    .status{margin-top:8px;font-size:13px}
    .ok{color:green}.err{color:#b91c1c}
    footer p{margin:4px 0;font-size:13px}
  </style>
</head>
<body>
  <header>
    <h1>ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª PDF Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
    <div class="muted">Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†ÙÙŠØ° â€¢ Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª â€¢ ØªØ­Ø¯ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙØ­Ø§Øª â€¢ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
  </header>

  <main class="grid">
    <!-- 1) Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF (Ù…Ø¹ ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù„Ø³Ø­Ø¨) -->
    <section class="tool" id="tool-merge">
      <h2>ğŸ”— Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF</h2>
      <p class="sub">Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©ØŒ Ø«Ù… Ø£Ø¹Ø¯ ØªØ±ØªÙŠØ¨Ù‡Ø§ Ø¨Ø§Ù„Ø³Ø­Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ù…Ø¬.</p>
      <div class="row">
        <input type="file" id="merge-input" accept="application/pdf" multiple />
        <button class="btn outline" id="merge-clear">ØªÙØ±ÙŠØº</button>
      </div>
      <div class="preview">
        <div class="thumbs" id="merge-thumbs"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="merge-run">Ø¯Ù…Ø¬</button>
        <div class="status" id="merge-status"></div>
      </div>
      <div class="downloads" id="merge-dl"></div>
    </section>

    <!-- 2) ØªØ­ÙˆÙŠÙ„ ØµÙˆØ± âœ PDF (Ù…Ø¹ ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù„Ø³Ø­Ø¨) -->
    <section class="tool" id="tool-img2pdf">
      <h2>ğŸ–¼ï¸ ØªØ­ÙˆÙŠÙ„ ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h2>
      <p class="sub">Ø§Ø±ÙØ¹ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„ØµÙˆØ± (PNG/JPG/WebP)ØŒ ÙˆØ£Ø¹Ø¯ ØªØ±ØªÙŠØ¨Ù‡Ø§ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„.</p>
      <div class="row">
        <input type="file" id="img-input" accept="image/*" multiple />
        <button class="btn outline" id="img-clear">ØªÙØ±ÙŠØº</button>
      </div>
      <div class="preview">
        <div class="thumbs" id="img-thumbs"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="img2pdf-run">ØªØ­ÙˆÙŠÙ„</button>
        <div class="status" id="img-status"></div>
      </div>
      <div class="downloads" id="img-dl"></div>
    </section>

    <!-- 3) ØªØ­ÙˆÙŠÙ„ PDF âœ ØµÙˆØ± (Ù…Ø¹ Ù†Ø·Ø§Ù‚ ØµÙØ­Ø§Øª) -->
    <section class="tool" id="tool-pdf2img">
      <h2>ğŸ“„ ØªØ­ÙˆÙŠÙ„ PDF Ø¥Ù„Ù‰ ØµÙˆØ± (PNG)</h2>
      <p class="sub">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù ÙˆØ­Ø¯Ø¯ Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙØ­Ø§Øª (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§ Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒÙ„).</p>
      <div class="row">
        <input type="file" id="pdf2img-input" accept="application/pdf" />
        <span class="range">
          Ù…Ù†: <input type="number" id="pdf2img-from" min="1" style="width:90px">
          Ø¥Ù„Ù‰: <input type="number" id="pdf2img-to" min="1" style="width:90px">
        </span>
      </div>
      <div class="preview">
        <div id="pdf2img-preview" class="thumbs"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="pdf2img-run">ØªØ­ÙˆÙŠÙ„</button>
        <div class="status" id="pdf2img-status"></div>
      </div>
      <div class="downloads" id="pdf2img-dl"></div>
    </section>

    <!-- 4) ØªÙ‚Ø³ÙŠÙ… PDF Ø­Ø³Ø¨ Ù†Ø·Ø§Ù‚ ØµÙØ­Ø§Øª -->
    <section class="tool" id="tool-split">
      <h2>âœ‚ï¸ ØªÙ‚Ø³ÙŠÙ… Ù…Ù„Ù PDF</h2>
      <p class="sub">Ø­Ø¯Ø¯ Ù…Ù† Ø£ÙŠ ØµÙØ­Ø© Ø¥Ù„Ù‰ Ø£ÙŠ ØµÙØ­Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯.</p>
      <div class="row">
        <input type="file" id="split-input" accept="application/pdf" />
        <span class="range">
          Ù…Ù†: <input type="number" id="split-from" min="1" style="width:90px">
          Ø¥Ù„Ù‰: <input type="number" id="split-to" min="1" style="width:90px">
        </span>
      </div>
      <div class="preview">
        <div id="split-preview" class="thumbs"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="split-run">ØªÙ‚Ø³ÙŠÙ…</button>
        <div class="status" id="split-status"></div>
      </div>
      <div class="downloads" id="split-dl"></div>
    </section>

    <!-- 5) Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ: Ù…Ù† PDF (Ù†Øµ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±) + Ù…Ù† Ø§Ù„ØµÙˆØ± (OCR) -->
    <section class="tool" id="tool-extract">
      <h2>ğŸ“ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ</h2>
      <p class="sub">Ù…Ù† PDF (Ù†Øµ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±) Ø£Ùˆ Ù…Ù† Ø§Ù„ØµÙˆØ± Ø¹Ø¨Ø± OCR (Tesseract ara+eng).</p>
      <div class="row">
        <input type="file" id="txt-pdf-input" accept="application/pdf" />
        <span class="range">
          Ù…Ù† ØµÙØ­Ø©: <input type="number" id="txt-pdf-from" min="1" style="width:90px">
          Ø¥Ù„Ù‰ ØµÙØ­Ø©: <input type="number" id="txt-pdf-to" min="1" style="width:90px">
        </span>
        <button class="btn" id="txt-pdf-run">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Øµ Ù…Ù† PDF</button>
      </div>
      <div class="row" style="margin-top:8px">
        <input type="file" id="txt-img-input" accept="image/*" multiple />
        <button class="btn outline" id="txt-ocr-run">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ± (OCR)</button>
      </div>
      <div class="preview" style="max-height:220px;overflow:auto">
        <pre id="txt-output" style="white-space:pre-wrap;word-wrap:break-word;margin:0"></pre>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="txt-save">Ø­ÙØ¸ ÙƒÙ†Øµ TXT</button>
        <div class="status" id="txt-status"></div>
      </div>
    </section>


    

  </main>

  <footer>
    <p>ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø©: Ø­Ø³ÙŠÙ† Ø¹Ù‚ÙŠÙ„ ØµØ¨Ø±ÙŠ ğŸ‘¨â€ğŸ’» â€” ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ©ØŒ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª.</p>
    <p class="muted">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…ÙˆØ§ØµÙØ§Øª Ø¬Ù‡Ø§Ø²Ùƒ ÙˆØ­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØ§Øª. Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¶Ø®Ù…Ø© Ø¬Ø¯Ù‹Ø§ ÙŠÙÙ†ØµØ­ Ø¨Ø®Ø§Ø¯Ù… Ø®Ù„ÙÙŠ.</p>
  </footer>

  <script>
    /* ============ Ø­Ø§Ù„Ø©/Ø°Ø§ÙƒØ±Ø© Ù…Ø­Ù„ÙŠØ© ============ */
    let mergeFiles = []; // [{file, thumbCanvas}]
    let imgFiles   = []; // [{file, imgEl}]

    /* ============ Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø© ============ */
    const byId = (id)=>document.getElementById(id);
    function downloadBlob(blob, filename){
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.click();
      setTimeout(()=>URL.revokeObjectURL(url),2000);
    }
    const clampRange = (from, to, max)=>{
      let s = Math.max(1, from||1);
      let e = Math.min(max, to||max);
      if (s>e) [s,e]=[e,s];
      return [s,e];
    };

    /* ============ Ø¹Ø±Ø¶ Ù…ØµØºØ±Ø§Øª PDF (ØµÙØ­Ø© Ø£ÙˆÙ„Ù‰) ============ */
    async function renderPdfFirstPageThumb(file, scale=0.28){
      const buf = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({data:buf}).promise;
      const page = await pdf.getPage(1);
      const viewport = page.getViewport({ scale });
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = viewport.width; canvas.height = viewport.height;
      await page.render({canvasContext:ctx, viewport}).promise;
      return canvas;
    }

    /* ============ Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª Ø¹Ø§Ù… Ù„Ù„Ù…ØµÙÙˆÙØ§Øª ============ */
    function enableDragSort(container, items, onReorder){
      // items: Ù…ØµÙÙˆÙØ© ÙƒØ§Ø¦Ù†Ø§Øª (mergeFiles / imgFiles)
      container.querySelectorAll('.thumb').forEach((el, idx)=>{
        el.draggable = true;
        el.addEventListener('dragstart', e=>{
          e.dataTransfer.setData('text/plain', idx.toString());
          el.classList.add('dragging');
        });
        el.addEventListener('dragend', ()=>el.classList.remove('dragging'));
        el.addEventListener('dragover', e=>{ e.preventDefault(); el.classList.add('drag-over'); });
        el.addEventListener('dragleave', ()=>el.classList.remove('drag-over'));
        el.addEventListener('drop', e=>{
          e.preventDefault();
          el.classList.remove('drag-over');
          const from = parseInt(e.dataTransfer.getData('text/plain'));
          const to = idx;
          if (from===to) return;
          const [moved] = items.splice(from,1);
          items.splice(to,0,moved);
          onReorder();
        });
      });
    }

    /* ============ 1) Ø§Ù„Ø¯Ù…Ø¬ ============ */
    byId('merge-input').addEventListener('change', async (e)=>{
      mergeFiles = [];
      const container = byId('merge-thumbs'); container.innerHTML='';
      const files = Array.from(e.target.files);
      for (const f of files){
        const thumb = await renderPdfFirstPageThumb(f);
        const wrap = document.createElement('div'); wrap.className='thumb';
        const badge = document.createElement('div'); badge.className='handle'; badge.textContent='â ¿ Ø§Ø³Ø­Ø¨';
        wrap.appendChild(badge); wrap.appendChild(thumb); container.appendChild(wrap);
        mergeFiles.push({file:f, el:wrap});
      }
      enableDragSort(container, mergeFiles, ()=>{
        // Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ØŒ Ø£Ø¹Ø¯ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ DOM Ø¨ØªØ±ØªÙŠØ¨ Ø¬Ø¯ÙŠØ¯
        container.innerHTML='';
        mergeFiles.forEach(m=>container.appendChild(m.el));
      });
      byId('merge-status').textContent = mergeFiles.length ? `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${mergeFiles.length} Ù…Ù„Ù(Ø§Øª).` : '';
      byId('merge-dl').innerHTML='';
    });

    byId('merge-clear').addEventListener('click', ()=>{
      mergeFiles=[]; byId('merge-thumbs').innerHTML=''; byId('merge-input').value='';
      byId('merge-status').textContent=''; byId('merge-dl').innerHTML='';
    });

    byId('merge-run').addEventListener('click', async ()=>{
      const status = byId('merge-status');
      if (!mergeFiles.length){ alert('Ø§Ø®ØªØ± Ù…Ù„ÙÙŠÙ† Ø£Ùˆ Ø£ÙƒØ«Ø±'); return; }
      status.textContent='â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø¯Ù…Ø¬...';
      try{
        const out = await PDFLib.PDFDocument.create();
        for (const {file} of mergeFiles){
          const buf = await file.arrayBuffer();
          const doc = await PDFLib.PDFDocument.load(buf);
          const pages = await out.copyPages(doc, doc.getPageIndices());
          pages.forEach(p=>out.addPage(p));
        }
        const bytes = await out.save();
        const blob = new Blob([bytes], {type:'application/pdf'});
        byId('merge-dl').innerHTML='';
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob); a.download='merged.pdf'; a.textContent='ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¯Ù…ÙˆØ¬';
        byId('merge-dl').appendChild(a);
        status.innerHTML = '<span class="ok">âœ… ØªÙ… Ø§Ù„Ø¯Ù…Ø¬</span>';
      }catch(err){
        status.innerHTML = `<span class="err">âŒ Ø®Ø·Ø£: ${err.message}</span>`;
      }
    });

    /* ============ 2) ØµÙˆØ± âœ PDF ============ */
    byId('img-input').addEventListener('change', (e)=>{
      imgFiles = [];
      const container = byId('img-thumbs'); container.innerHTML='';
      const files = Array.from(e.target.files);
      for (const f of files){
        const url = URL.createObjectURL(f);
        const img = document.createElement('img'); img.src=url;
        const wrap = document.createElement('div'); wrap.className='thumb';
        const badge = document.createElement('div'); badge.className='handle'; badge.textContent='â ¿ Ø§Ø³Ø­Ø¨';
        wrap.appendChild(badge); wrap.appendChild(img); container.appendChild(wrap);
        imgFiles.push({file:f, el:wrap, url});
      }
      enableDragSort(container, imgFiles, ()=>{
        container.innerHTML=''; imgFiles.forEach(m=>container.appendChild(m.el));
      });
      byId('img-status').textContent = imgFiles.length ? `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${imgFiles.length} ØµÙˆØ±Ø©.` : '';
      byId('img-dl').innerHTML='';
    });

    byId('img-clear').addEventListener('click', ()=>{
      imgFiles.forEach(m=>URL.revokeObjectURL(m.url));
      imgFiles=[]; byId('img-thumbs').innerHTML=''; byId('img-input').value='';
      byId('img-status').textContent=''; byId('img-dl').innerHTML='';
    });

    byId('img2pdf-run').addEventListener('click', async ()=>{
      const status = byId('img-status');
      if (!imgFiles.length){ alert('Ø§Ø®ØªØ± ØµÙˆØ±Ù‹Ø§'); return; }
      status.textContent='â³ Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ PDF...';
      try{
        const doc = await PDFLib.PDFDocument.create();
        for (const {file} of imgFiles){
          const bytes = await file.arrayBuffer();
          let img, dims;
          if (file.type==='image/png') img = await doc.embedPng(bytes);
          else img = await doc.embedJpg(bytes); // JPG / JPEG / WEBP via jpg path if supported
          dims = img.scale(1);
          const page = doc.addPage([dims.width, dims.height]);
          page.drawImage(img, {x:0,y:0,width:dims.width,height:dims.height});
        }
        const pdfBytes = await doc.save();
        const blob = new Blob([pdfBytes], {type:'application/pdf'});
        byId('img-dl').innerHTML='';
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob); a.download='images.pdf'; a.textContent='ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF';
        byId('img-dl').appendChild(a);
        status.innerHTML = '<span class="ok">âœ… Ø¬Ø§Ù‡Ø²</span>';
      }catch(err){
        status.innerHTML = `<span class="err">âŒ Ø®Ø·Ø£: ${err.message}</span>`;
      }
    });

    /* ============ 3) PDF âœ ØµÙˆØ± (PNG) ============ */
    byId('pdf2img-input').addEventListener('change', async (e)=>{
      const prev = byId('pdf2img-preview'); prev.innerHTML='';
      byId('pdf2img-status').textContent='';
      const f = e.target.files[0]; if(!f) return;
      // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£ÙˆÙ„ 3 ØµÙØ­Ø§Øª Ù…ØµØºØ±Ø©
      try{
        const buf = await f.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({data:buf}).promise;
        const maxPrev = Math.min(3, pdf.numPages);
        for (let p=1; p<=maxPrev; p++){
          const page = await pdf.getPage(p);
          const viewport = page.getViewport({scale:.3});
          const c = document.createElement('canvas'); const ctx = c.getContext('2d');
          c.width=viewport.width; c.height=viewport.height;
          await page.render({canvasContext:ctx,viewport}).promise;
          const wrap=document.createElement('div'); wrap.className='thumb'; wrap.appendChild(c);
          prev.appendChild(wrap);
        }
      }catch(err){
        byId('pdf2img-status').innerHTML=`<span class="err">âš ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© ÙØ´Ù„Øª: ${err.message}</span>`;
      }
    });

    byId('pdf2img-run').addEventListener('click', async ()=>{
      const input = byId('pdf2img-input'); const status = byId('pdf2img-status');
      const outBox = byId('pdf2img-dl'); outBox.innerHTML='';
      if (!input.files.length){ alert('Ø§Ø®ØªØ± Ù…Ù„Ù PDF'); return; }
      status.textContent='â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØµÙˆØ±...';

      try{
        const f = input.files[0];
        const buf = await f.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({data:buf}).promise;
        const total = pdf.numPages;
        const [from,to] = clampRange(parseInt(byId('pdf2img-from').value), parseInt(byId('pdf2img-to').value), total);
        const zip = new JSZip();

        for (let p=from; p<=to; p++){
          const page = await pdf.getPage(p);
          const viewport = page.getViewport({scale:1.5});
          const c = document.createElement('canvas'); const ctx = c.getContext('2d');
          c.width=viewport.width; c.height=viewport.height;
          await page.render({canvasContext:ctx,viewport}).promise;
          const blob = await new Promise(res=>c.toBlob(res,'image/png'));
          zip.file(`page-${p}.png`, blob);
          status.textContent=`ğŸ”„ ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙØ­Ø© ${p}/${to}`;
        }
        const zipBlob = await zip.generateAsync({type:'blob'});
        const a = document.createElement('a');
        a.href=URL.createObjectURL(zipBlob);
        a.download=`${f.name.replace(/\.pdf$/i,'')}_images_${from}-${to}.zip`;
        a.textContent='ğŸ“¦ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± (ZIP)';
        outBox.appendChild(a);
        status.innerHTML='<span class="ok">âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</span>';
      }catch(err){
        status.innerHTML=`<span class="err">âŒ Ø®Ø·Ø£: ${err.message}</span>`;
      }
    });

    /* ============ 4) ØªÙ‚Ø³ÙŠÙ… PDF ============ */
    byId('split-input').addEventListener('change', async (e)=>{
      const prev = byId('split-preview'); prev.innerHTML='';
      byId('split-status').textContent='';
      const f = e.target.files[0]; if(!f) return;
      try{
        const thumb = await renderPdfFirstPageThumb(f, .28);
        const wrap=document.createElement('div'); wrap.className='thumb'; wrap.appendChild(thumb);
        prev.appendChild(wrap);
      }catch(err){
        byId('split-status').innerHTML=`<span class="err">âš ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© ÙØ´Ù„Øª: ${err.message}</span>`;
      }
    });

    byId('split-run').addEventListener('click', async ()=>{
      const input = byId('split-input'); const status = byId('split-status');
      const outBox = byId('split-dl'); outBox.innerHTML='';
      if (!input.files.length){ alert('Ø§Ø®ØªØ± Ù…Ù„Ù PDF'); return; }
      status.textContent='â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªÙ‚Ø³ÙŠÙ…...';
      try{
        const f = input.files[0];
        const buf = await f.arrayBuffer();
        const src = await PDFLib.PDFDocument.load(buf);
        const total = src.getPageCount();
        const [from,to] = clampRange(parseInt(byId('split-from').value), parseInt(byId('split-to').value), total);
        const out = await PDFLib.PDFDocument.create();
        const pages = await out.copyPages(src, Array.from({length:(to-from+1)},(_,i)=>i+from-1));
        pages.forEach(p=>out.addPage(p));
        const bytes = await out.save();
        const blob = new Blob([bytes], {type:'application/pdf'});
        const a = document.createElement('a');
        a.href=URL.createObjectURL(blob);
        a.download=`split-${from}-to-${to}.pdf`;
        a.textContent='ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ù‚Ø³Ù‘Ù…';
        outBox.appendChild(a);
        status.innerHTML='<span class="ok">âœ… ØªÙ… Ø§Ù„ØªÙ‚Ø³ÙŠÙ…</span>';
      }catch(err){
        status.innerHTML=`<span class="err">âŒ Ø®Ø·Ø£: ${err.message}</span>`;
      }
    });

    /* ============ 5) Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ ============ */
    // 5a) Ù…Ù† PDF (Ù†Øµ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±)
    byId('txt-pdf-run').addEventListener('click', async ()=>{
      const input = byId('txt-pdf-input'); const status=byId('txt-status'); const out=byId('txt-output');
      out.textContent=''; status.textContent='';
      if(!input.files.length){ alert('Ø§Ø®ØªØ± PDF'); return; }
      status.textContent='â³ Ø¬Ø§Ø±Ù Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† PDF...';
      try{
        const f=input.files[0]; const buf=await f.arrayBuffer();
        const pdf=await pdfjsLib.getDocument({data:buf}).promise;
        const total=pdf.numPages;
        const [from,to]=clampRange(parseInt(byId('txt-pdf-from').value), parseInt(byId('txt-pdf-to').value), total);
        let text='';
        for(let p=from;p<=to;p++){
          const page=await pdf.getPage(p);
          const tc=await page.getTextContent();
          const line=tc.items.map(i=>i.str).join(' ');
          text+=`[Ø§Ù„ØµÙØ­Ø© ${p}]\n${line}\n\n`;
          status.textContent=`ğŸ”„ ØµÙØ­Ø© ${p}/${to}`;
        }
        out.textContent=text.trim();
        status.innerHTML='<span class="ok">âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</span>';
      }catch(err){
        status.innerHTML=`<span class="err">âŒ Ø®Ø·Ø£: ${err.message}</span>`;
      }
    });

    // 5b) Ù…Ù† Ø§Ù„ØµÙˆØ± (OCR Ø¹Ø¨Ø± Tesseract)
    byId('txt-ocr-run').addEventListener('click', async ()=>{
      const input = byId('txt-img-input'); const status=byId('txt-status'); const out=byId('txt-output');
      if(!input.files.length){ alert('Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£Ùˆ Ø£ÙƒØ«Ø±'); return; }
      out.textContent=''; status.textContent='â³ OCR Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
      try{
        let combined='';
        const files=Array.from(input.files);
        for (let idx=0; idx<files.length; idx++){
          const f=files[idx];
          const { data:{ text } } = await Tesseract.recognize(f,'ara+eng',{
            logger:m=>{ status.textContent=`ğŸ”„ ${m.status} ${Math.round((m.progress||0)*100)}% â€” (${idx+1}/${files.length})`; }
          });
          combined += `[[Ø§Ù„ØµÙˆØ±Ø© ${idx+1}: ${f.name}]]\n${text.trim()}\n\n`;
        }
        byId('txt-output').textContent = combined.trim();
        status.innerHTML = '<span class="ok">âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±</span>';
      }catch(err){
        status.innerHTML = `<span class="err">âŒ Ø®Ø·Ø£: ${err.message}</span>`;
      }
    });

    // Ø­ÙØ¸ Ø§Ù„Ù†Ø§ØªØ¬ ÙƒÙ†Øµ
    byId('txt-save').addEventListener('click', ()=>{
      const text = byId('txt-output').textContent || '';
      if (!text.trim()){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù…Ø­ÙÙˆØ¸ Ø¨Ø¹Ø¯.'); return; }
      downloadBlob(new Blob([text],{type:'text/plain;charset=utf-8'}),'extracted-text.txt');
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="..//Photo/t ~.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Suite | منصة الأدوات الاحترافية</title>

  <!-- Libraries -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <!-- Sortable.js for drag and drop sorting -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    /* (نفس التنسيقات الأصلية التي وضعتها، لم ألمسها) */
    :root {
      --bg-color: #eef2f9;
      --card-color: #f5f8fc;
      --primary-color: #4a55ff;
      --primary-light: #6a72ff;
      --secondary-color: #a45eff;
      --text-color: #2c3e50;
      --muted-color: #8d99ae;
      --border-color: rgba(255, 255, 255, 0.5);
      --shadow-light: rgba(136, 165, 191, 0.48);
      --shadow-dark: rgba(255, 255, 255, 0.8);
      --radius: 16px;
      --transition: all 0.3s ease;
    }
    /* ... باقي التنسيقات عندك (ما غيرتها) ... */
    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .option-group label { display:block; margin-bottom:8px; font-weight:500; color:var(--muted-color);}
    select {
      width:100%;
      padding:12px;
      border:1px solid var(--border-color);
      border-radius:10px;
      background:var(--bg-color);
      color:var(--text-color);
      font-size:1rem;
    }
  </style>
</head>
<body>

  <!-- ... القائمة الجانبية كما هي ... -->

  <main class="main-content">
    <!-- Page 1: Merge -->
    <!-- (بدون تغيير) -->

    <!-- Page 2: Images to PDF -->
    <section id="img2pdf" class="tool-page">
      <div class="page-header">
        <h1>تحويل صور إلى PDF</h1>
        <p>اجمع صورك في ملف PDF واحد أنيق وسهل المشاركة.</p>
      </div>
      <div class="tool-card">
        <div class="input-area" id="img2pdf-dropzone">
          <i class="fas fa-images fa-3x" style="color:var(--muted-color); margin-bottom:15px;"></i>
          <p>اسحب وأفلت الصور هنا، أو <label for="img2pdf-input">اختر من جهازك</label></p>
          <input type="file" id="img2pdf-input" accept="image/*" multiple>
        </div>
        <div class="preview-area">
          <div class="sort-instructions" id="img2pdf-sort-instructions">
            <i class="fas fa-arrows-alt"></i>
            اسحب الصور لإعادة ترتيبها حسب الترتيب المطلوب في ملف PDF
          </div>
          <div class="thumbs" id="img2pdf-thumbs"></div>
        </div>

        <!-- ✅ خيارات جديدة -->
        <div class="options-grid">
          <div class="option-group">
            <label for="img2pdf-size">حجم الصفحة</label>
            <select id="img2pdf-size">
              <option value="auto">مطابقة حجم الصورة</option>
              <option value="A4">A4 (210 × 297 ملم)</option>
              <option value="Letter">Letter (8.5 × 11 إنش)</option>
            </select>
          </div>
          <div class="option-group">
            <label for="img2pdf-fit">طريقة العرض</label>
            <select id="img2pdf-fit">
              <option value="fit">ملء الصفحة</option>
              <option value="original">الحجم الأصلي</option>
            </select>
          </div>
        </div>
        <!-- ✅ نهاية الخيارات -->

        <div class="status-area" id="img2pdf-status-area">
          <div class="progress-bar"><div class="progress-bar-inner"></div></div>
          <span class="status-text"></span>
        </div>
        <div style="margin-top: 20px; display: flex; gap: 15px;">
          <button class="btn" id="img2pdf-run" disabled><i class="fas fa-play"></i> بدء التحويل</button>
          <button class="btn outline" id="img2pdf-clear">مسح الكل</button>
        </div>
      </div>
    </section>

    <!-- باقي الصفحات (pdf2img / split / extract) مثل ما هي -->
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const appState = { img2pdf: { files: [], sortable: null } };

      // === تعديل وحدة img2pdf ===
      (() => {
        const tool = 'img2pdf';
        const state = appState.img2pdf;
        const input = document.getElementById(`${tool}-input`);
        const thumbs = document.getElementById(`${tool}-thumbs`);
        const runBtn = document.getElementById(`${tool}-run`);
        const clearBtn = document.getElementById(`${tool}-clear`);
        const sortInstructions = document.getElementById(`${tool}-sort-instructions`);

        const sizeSelect = document.getElementById("img2pdf-size");
        const fitSelect = document.getElementById("img2pdf-fit");

        if (input) {
          input.addEventListener('change', (e) => {
            state.files = Array.from(e.target.files);
            runBtn.disabled = state.files.length === 0;
            thumbs.innerHTML = '';
            state.files.forEach((file, idx) => {
              const url = URL.createObjectURL(file);
              const img = document.createElement('img');
              img.src = url;
              const wrap = document.createElement('div');
              wrap.className = 'thumb';
              wrap.setAttribute('data-order', idx + 1);
              wrap.appendChild(img);
              thumbs.appendChild(wrap);
            });
          });
        }

        if (clearBtn) {
          clearBtn.addEventListener('click', () => {
            state.files = [];
            thumbs.innerHTML = '';
            input.value = '';
            runBtn.disabled = true;
          });
        }

        if (runBtn) {
          runBtn.addEventListener('click', async () => {
            if (state.files.length === 0) return alert('اختر صورة واحدة على الأقل');
            runBtn.disabled = true;

            try {
              const pdfDoc = await PDFLib.PDFDocument.create();

              for (let i = 0; i < state.files.length; i++) {
                const file = state.files[i];
                const bytes = await file.arrayBuffer();
                let img;
                if (file.type === 'image/png') img = await pdfDoc.embedPng(bytes);
                else img = await pdfDoc.embedJpg(bytes);

                // ✅ هنا خيارات المستخدم
                const sizeChoice = sizeSelect.value;
                const fitChoice = fitSelect.value;

                let pageWidth, pageHeight;
                if (sizeChoice === "A4") {
                  pageWidth = 595.28; // 210mm
                  pageHeight = 841.89; // 297mm
                } else if (sizeChoice === "Letter") {
                  pageWidth = 612;  
                  pageHeight = 792;  
                } else {
                  pageWidth = img.width;
                  pageHeight = img.height;
                }

                const page = pdfDoc.addPage([pageWidth, pageHeight]);

                if (fitChoice === "fit" && sizeChoice !== "auto") {
                  const scale = Math.min(pageWidth / img.width, pageHeight / img.height);
                  const imgW = img.width * scale;
                  const imgH = img.height * scale;
                  const x = (pageWidth - imgW) / 2;
                  const y = (pageHeight - imgH) / 2;
                  page.drawImage(img, { x, y, width: imgW, height: imgH });
                } else {
                  page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
                }
              }

              const pdfBytes = await pdfDoc.save();
              const blob = new Blob([pdfBytes], { type: 'application/pdf' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'images.pdf';
              a.click();
              URL.revokeObjectURL(url);
              alert("✅ تم إنشاء PDF بنجاح!");
            } catch (err) {
              alert("❌ خطأ: " + err.message);
            }
            runBtn.disabled = false;
          });
        }
      })();
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="..//Photo/t ~.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Suite | منصة الأدوات الاحترافية</title>

  <!-- Libraries -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <!-- Sortable.js for drag and drop sorting -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    /* 🎨 نفس التنسيقات الأصلية دون أي تغيير */
    :root {
      --bg-color: #eef2f9;
      --card-color: #f5f8fc;
      --primary-color: #4a55ff;
      --primary-light: #6a72ff;
      --secondary-color: #a45eff;
      --text-color: #2c3e50;
      --muted-color: #8d99ae;
      --border-color: rgba(255, 255, 255, 0.5);
      --shadow-light: rgba(136, 165, 191, 0.48);
      --shadow-dark: rgba(255, 255, 255, 0.8);
      --radius: 16px;
      --transition: all 0.3s ease;
    }
    [data-theme="dark"] {
      --bg-color: #1b1f28;
      --card-color: #242936;
      --primary-color: #5a64ff;
      --primary-light: #7a82ff;
      --secondary-color: #b46eff;
      --text-color: #edf2f4;
      --muted-color: #a0aec0;
      --border-color: rgba(0, 0, 0, 0.2);
      --shadow-light: rgba(0, 0, 0, 0.3);
      --shadow-dark: rgba(255, 255, 255, 0.05);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'IBM Plex Sans Arabic', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.7;
      display: flex;
      transition: var(--transition);
      overflow: hidden;
    }
    /* ... باقي CSS نفسه كما عندك بدون تعديل ... */
  </style>
</head>
<body>

  <aside class="sidebar">
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 10px;">
      <img src="..//Photo/timepdf.png" style="width: 90px; height: 90px; object-fit: contain; margin-bottom: 10px; border-radius: 50%; box-shadow: 0 2px 12px rgba(0,0,0,0.10);" />
    </div>
    <div class="logo" style="margin-bottom: 40px; text-align: center;">PDF Suite</div>
    <ul class="nav-menu">
      <li class="nav-item"><a data-page="merge" class="nav-link active"><i class="fas fa-link fa-fw"></i> دمج الملفات</a></li>
      <li class="nav-item"><a data-page="img2pdf" class="nav-link"><i class="fas fa-image fa-fw"></i> صور إلى PDF</a></li>
      <li class="nav-item"><a data-page="pdf2img" class="nav-link"><i class="fas fa-file-image fa-fw"></i> PDF إلى صور</a></li>
      <li class="nav-item"><a data-page="split" class="nav-link"><i class="fas fa-cut fa-fw"></i> تقسيم ملف</a></li>
      <li class="nav-item"><a data-page="extract" class="nav-link"><i class="fas fa-file-alt fa-fw"></i> استخراج النصوص</a></li>
    </ul>
    <button class="theme-switcher" id="theme-switcher"><i class="fas fa-moon"></i></button>
  </aside>

  <main class="main-content">
    <!-- 📌 نفس الصفحات (merge, img2pdf, pdf2img, split, extract) -->
    <!-- لم ألمسها أبداً، بقيت كما عندك -->
  </main>

  <div id="toast-container" class="toast-container"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ... نفس الأكواد العامة ...

      // 📌 وحدة صور إلى PDF (التعديل هنا فقط)
      (() => {
        const tool = 'img2pdf';
        const state = appState.img2pdf;
        const input = document.getElementById(`${tool}-input`);
        const thumbs = document.getElementById(`${tool}-thumbs`);
        const runBtn = document.getElementById(`${tool}-run`);
        const clearBtn = document.getElementById(`${tool}-clear`);
        const sortInstructions = document.getElementById(`${tool}-sort-instructions`);

        // ... نفس كود thumbs و clear ...

        if (runBtn) {
          runBtn.addEventListener('click', async () => {
            if (state.files.length === 0) return showToast('اختر صورة واحدة على الأقل', 'error');
            runBtn.disabled = true;
            updateStatus(tool, '🚀 بدء إنشاء PDF...', 0);

            try {
              const pdfDoc = await PDFLib.PDFDocument.create();

              for (let i = 0; i < state.files.length; i++) {
                const file = state.files[i];
                const bytes = await file.arrayBuffer();
                let img;
                if (file.type === 'image/png') img = await pdfDoc.embedPng(bytes);
                else img = await pdfDoc.embedJpg(bytes);

                // ✅ تحديد حجم الصفحة (A4 أو Letter أو Auto)
                const sizeChoice = document.getElementById("img2pdf-size")?.value || "auto";
                const fitChoice = document.getElementById("img2pdf-fit")?.value || "fit";

                let pageWidth, pageHeight;
                if (sizeChoice === "A4") {
                  pageWidth = 595.28; 
                  pageHeight = 841.89;
                } else if (sizeChoice === "Letter") {
                  pageWidth = 612;  
                  pageHeight = 792;  
                } else {
                  pageWidth = img.width;
                  pageHeight = img.height;
                }

                const page = pdfDoc.addPage([pageWidth, pageHeight]);

                if (fitChoice === "fit" && sizeChoice !== "auto") {
                  const scale = Math.min(pageWidth / img.width, pageHeight / img.height);
                  const imgW = img.width * scale;
                  const imgH = img.height * scale;
                  const x = (pageWidth - imgW) / 2;
                  const y = (pageHeight - imgH) / 2;
                  page.drawImage(img, { x, y, width: imgW, height: imgH });
                } else {
                  page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });
                }

                updateStatus(tool, `إضافة الصورة ${i + 1}/${state.files.length}`, ((i + 1) / state.files.length) * 100);
              }

              const pdfBytes = await pdfDoc.save();
              downloadBlob(new Blob([pdfBytes], { type: 'application/pdf' }), 'images.pdf');
              updateStatus(tool, '✅ اكتمل إنشاء PDF!');
              showToast('تم تحميل ملف PDF!', 'success');
            } catch (err) { 
              updateStatus(tool, `❌ خطأ: ${err.message}`); 
              showToast('فشل إنشاء PDF.', 'error'); 
            }
            runBtn.disabled = false;
          });
        }
      })();

      // ... باقي الوحدات (merge, pdf2img, split, extract) بدون أي تغيير ...
    });
  </script>
</body>
</html>
